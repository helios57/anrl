<!DOCTYPE html 
	PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
Copyright (c) 2008 Fraser Chapman
Author: Fraser Chapman
Email: fraser.chapman@gmail.com
Date: 2009-01-25
Summary:
This program is part of FC.GEPluginCtrls
FC.GEPluginCtrls is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.
This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.
You should have received a copy of the GNU General Public License
along with this program.  If not, see http://www.gnu.org/licenses/
-->
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta name="Author" content="Fraser Chapman" />
	<title>plugin code</title>
	<script type="text/javascript" src="http://www.google.com/jsapi"></script>
	<script type="text/javascript">
	/* <![CDATA[ */
	
	google.load("earth", "1");
	google.load("maps", "2.xx");

	var ge = null;
	var geocoder = null;
	var application = null;

  /**
  *
  * Internal methods called from javascript
  * suffix_
  *
  */
  
	var init_ = function() {
		google.earth.createInstance("map3d", initCallback_, failureCallback_);
		geocoder = new GClientGeocoder();
		application = window.external;
	}

	var failureCallback_ = function(object)
  {
    application.Error("Plugin failed to load");
  }

  var initCallback_ = function(object) {
      ge = object;
      ge.getWindow().setVisibility(true);
      application.Ready(ge);
  }
  
	var loadKmlCallBack_ = function(kmlObject)
	{
		if (kmlObject)
    {
			application.LoadKmlCallBack(kmlObject);
		}
    else
    {
      application.Error("Kml failed to load");
		}
	}

  /**
  *
  * Methods to be invoked from the c# application.
  * jsPrefix
  *
  */
  
  function loadKml(kml)
  {
	kml = ge.parseKml(kml);//parse the kml
	ge.getFeatures().appendChild(kml);//add the kml data to ge
  }
  
  var jsEvaluate = function(script)
  {
    return eval(script);
  }
  
  var jsExecute = function(script)
  {
    window.execScript(script);
  }
  
  var jsAddEventListener = function(feature, action)
  {
    if(ge)
    {
      google.earth.addEventListener(feature, action, function(kmlEvent) 
      {
        if(kmlEvent)
        {
          application.KmlEventCallBack(kmlEvent, action);
        }
      });
    }
  }
  
  var jsRemoveEventListner = function(feature, action)
  {
    if(ge)
    {
      google.earth.removeEventListener(feature, action, function (kmlEvent) 
      {
        if(application && kmlEvent)
        {
          application.KmlEventCallBack(kmlEvent, action);
        }
      });
    }
  }
  
	var jsFetchKml = function(url)
	{
		google.earth.fetchKml(ge, url, loadKmlCallBack_);
	}

	var jsDoGeocode = function(address)
	{
		geocoder.getLatLng(address, function(point)
		{
			if (point)
			{
				var lookat = ge.createLookAt("");
				lookat.set(point.y, point.x, 100, ge.ALTITUDE_RELATIVE_TO_GROUND, 0, 0, 1000);
				ge.getView().setAbstractView(lookat);
				return(point);
			} 
		});
	} 

	/* ]]> */
	</script>
	<style type="text/css">
	html, body { 
		margin:0px;
	}
	#map3d_container  { 
		display:block;
		position:absolute;
		top:0;
		left:0;
		width:100%;
		height:100%;
	}
	#map3d { 
		height: 100%;
	}
	</style>
</head>
<body onload='init_();' id='body'>
	<div id='map3d_container'>
		<div id='map3d'></div>
	</div>
</body>
</html>